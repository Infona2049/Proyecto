{% load static %}
{% load tz %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial Inventario</title>
    <link rel="icon" href="{% static 'img/favicon.png.png' %}" type="image/png">
    <link rel="stylesheet" href="{% static 'facturas/css/historial_factura.css' %}">
    <link rel="stylesheet" href="{% static 'productos/css/historial_inventario.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/logout_alert.css' %}">
    </head>
<body>
  <div class="top-bar">
    <div class="left-side">
      <a href="{% url 'visualizacion_admin' %}">
        <img src="{% static 'img/Logo azul sin fondo.png' %}" alt="EcoFact Logo" class="logo1" />
        <img src="{% static 'img/logo empresa.png' %}" alt="Empresa logo" class="logo2" />
      </a>
    </div>
    <div class="right-side">
      <a href="{% url 'documentos' %}"><img src="{% static 'img/documento.png' %}" class="icono"></a>
      <a href="{% url 'actualizar_perfil' %}"><img src="{% static 'img/editar.png' %}" class="icono"></a>
      <a href="{% url 'cambiocontraseña' %}"><img src="{% static 'img/contrasena.png' %}" class="icono"></a>
      <a href="{% url 'login' %}" onclick="showLogoutConfirmation(event, '{% url 'login' %}'); return false;"><img src="{% static 'img/cerrar-sesion.png' %}" class="icono"></a>
    </div>
  </div>

  <header>
    <nav class="menu">
      <a href="{% url 'visualizacion_admin' %}">Inicio</a>
      <a href="{% url 'inventario' %}" style="margin-left:20px">Inventario</a>
    </nav>
  </header>

  <main class="contenido">
    <!-- Filtros (igual estructura que historial_factura) -->
    <div class="filtros">
      <h2 class="titulo-historial">Historial de inventario</h2>
      <form class="filtros-linea" style="justify-content:center;align-items:center;" method="get">
        <div class="campo-fecha">
          <label for="fecha-inicial">Fecha Inicial:</label>
          <input type="date" id="fecha-inicial" name="fecha_inicial" value="{{ fecha_inicial }}" />
        </div>

        <div class="campo-fecha">
          <label for="fecha-final">Fecha Final:</label>
          <input type="date" id="fecha-final" name="fecha_final" value="{{ fecha_final }}" />
        </div>

      </form>
      <div class="campo-boton">
        <button type="button" class="boton-buscar">BUSCAR</button>
        <button type="button" class="boton-limpiar">LIMPIAR</button>
      </div>
    </div>

    <!-- Caja inferior: tarjetas de historial (dentro de cuadro-tabla para estilo similar) -->
    <div class="cuadro-tabla">
      <div class="historial-grid">
        <div class="cuadro-blanco cuadro-added">
          <div class="historial-card-title">Productos añadidos</div>
          <ul class="historial-card-list">
            {% if añadidos %}
              {% for r in añadidos %}
                <li>Producto ({{ r.producto_id }}) {{ r.nombre_producto }} - {{ r.timestamp|localtime|date:"d/m/Y H:i" }}</li>
              {% endfor %}
            {% else %}
              <li>No se han añadido productos en este rango.</li>
            {% endif %}
          </ul>
        </div>

        <div class="cuadro-blanco cuadro-removed">
          <div class="historial-card-title">Productos eliminados</div>
          <ul class="historial-card-list">
            {% if eliminados %}
              {% for r in eliminados %}
                <li>Producto ({{ r.producto_id }}) {{ r.nombre_producto }} - {{ r.timestamp|localtime|date:"d/m/Y H:i" }}</li>
              {% endfor %}
            {% else %}
              <li>No se han eliminado productos en este rango.</li>
            {% endif %}
          </ul>
        </div>

        <div class="cuadro-blanco cuadro-edited">
          <div class="historial-card-title">Productos editados</div>
          <ul class="historial-card-list">
            {% if editados %}
              {% for r in editados %}
                <li class="historial-edicion-item">
                  <div class="historial-edicion-header">
                    <strong>Producto ({{ r.producto_id }})</strong>
                    {% if r.nombre_producto %}&nbsp;{{ r.nombre_producto }}{% endif %}
                    &nbsp;-&nbsp;<span class="historial-fecha">{{ r.timestamp|localtime|date:"H:i" }}</span>
                  </div>

                  {% if r.modificaciones %}
                    <ul class="modificaciones-list">
                      {% for field, vals in r.modificaciones.items %}
                        <li>
                          {# Mostrar etiquetas más amigables para campos de stock #}
                          {% if field == 'stock_actual_inventario' %}
                            stock &nbsp;"<span class="valor-anterior">{{ vals.0|default:"" }}</span>" &nbsp;-&nbsp; "<span class="valor-nuevo">{{ vals.1|default:"" }}</span>"
                          {% elif field == 'stock_minimo_inventario' %}
                            stock_minimo &nbsp;"<span class="valor-anterior">{{ vals.0|default:"" }}</span>" &nbsp;-&nbsp; "<span class="valor-nuevo">{{ vals.1|default:"" }}</span>"
                          {% else %}
                            {{ field }} &nbsp;"<span class="valor-anterior">{{ vals.0|default:"" }}</span>" &nbsp;-&nbsp; "<span class="valor-nuevo">{{ vals.1|default:"" }}</span>"
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </li>
              {% endfor %}
            {% else %}
              <li>No se han editado productos en este rango.</li>
            {% endif %}
          </ul>
        </div>
      </div>
      </div>

      <!-- Caja adicional debajo de historiales (placeholder) -->
      <div class="cuadro-tabla" style="margin-top:18px;padding:18px;">
        <h3 style="color:#003f87;margin-bottom:12px;">Productos vendidos</h3>
        <div class="tabla-container">
          <table class="tabla-inventario">
            <thead>
              <tr>
                <th>Num Producto</th>
                <th>Descripción</th>
                <th>Color</th>
                <th>Almacenamiento</th>
                <th>Precio</th>
              </tr>
            </thead>
            <tbody>
              {% if ventas %}
                {% for d in ventas %}
                  <tr>
                    <td>{{ d.producto.id_producto }}</td>
                    <td>{{ d.producto.nombre_producto }}</td>
                    <td>{{ d.producto.color_producto }}</td>
                    <td>{{ d.producto.capacidad_producto }}</td>
                    <td>${{ d.precio }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5">No se encontraron ventas en el rango seleccionado.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
  </main>

  <footer>
    <div class="footer-bar">
      <div class="footer-item">
        <img src="{% static 'img/mensaje.png' %}" alt="Correo">
        Ecofactproyect@gmail.com
      </div>
      <div class="footer-item">
        <img src="{% static 'img/llamada-telefonica.png' %}" alt="Teléfono">
        333-333-333
      </div>
    </div>
    <div class="footer-bottom">@2025-ECOFACT</div>
  </footer>
  
  <script src="{% static 'core/js/logout_confirmation.js' %}"></script>
  <script src="{% static 'productos/js/historial_inventario.js' %}"></script>
</body>
</html>
